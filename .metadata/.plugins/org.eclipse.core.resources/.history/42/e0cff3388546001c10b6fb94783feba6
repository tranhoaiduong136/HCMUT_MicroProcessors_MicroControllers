/*
 * 7SEG_LED.c
 *
 *  Created on: Oct 31, 2021
 *      Author: Duong
 */#include "main.h"
#include "7SEG_LED.h"

static uint8_t sevenSegmentLEDConversionAnode[10] = {
		// Convert from binary of anode led to hex
		0xC0, //0
		0xF9, //1
		0xA4, //2
		0xB0, //3
		0x99, //4
		0x92, //5
		0x82, //6
		0xF8, //7
		0x80, //8
		0x90  //9
};
// FOR Cathode if it is used

//static uint8_t sevenSegmentLEDConversionCathode[10] = {
//		0x3F, //0
//		0x06, //1
//		0x5B, //2
//		0x4F, //3
//		0x66, //4
//		0x6D, //5
//		0x7D, //6
//		0x07, //7
//		0x7F, //8
//		0x4F, //9
//};
static uint8_t sevenSegmentbitConversion[7] = {0x01,0x02,0x04,0x08,0x10,0x20,0x40};
static uint16_t gate[14] = {SEG0,SEG1,SEG2,SEG3,SEG4,SEG5,SEG6,
//		SEG7,SEG8,SEG9,SEG10,SEG11,SEG12,SEG13
};

static uint8_t sevenSegmentLEDBuffer[NUMS_7SEGS];

static uint16_t ENA[NUMS] = {EN0,EN1,EN2,EN3};
static int led_buffer[4] = {0,0,0,0};
void InitEnable(void){
	for(int i = 0; i < NUMS;i++){
		HAL_GPIO_WritePin(GROUP_EN,ENA[i], SET);
	}
}
 void update7SEGBuffer(int h,int m){
	 // Hour
		 led_buffer[0] = h /10;
		 led_buffer[1] = h % 10;
	 // Minute
		 led_buffer[2] = m /10;
	 	 led_buffer[3] = m % 10;
}


void sevenSegmentLEDInit(void){
	for(int i = 0; i < 14;i++){
	HAL_GPIO_WritePin(GPIOB, gate[i],SET);
	}
}

void updatesevenSegmentLEDBuffer(uint8_t val,int idx){
	sevenSegmentLEDBuffer[idx] = val;
}
void sevenSegementLEDDriver(int idx){
	uint8_t temp = sevenSegmentLEDConversionAnode[sevenSegmentLEDBuffer[idx]];
	for(int i = 0; i < 7;i++){
		if(temp & sevenSegmentbitConversion[i]){
			HAL_GPIO_WritePin(GPIOB, gate[i + 7*idx], SET);
		}
		else{
			HAL_GPIO_WritePin(GPIOB, gate[i + 7*idx], RESET);
		}

	}
}


